"use strict";(self.webpackChunkzynthbox_webconf_metaheader=self.webpackChunkzynthbox_webconf_metaheader||[]).push([[688],{4688:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var a=n(5861),l=n(885),i=n(4687),o=n.n(i),r=n(7294),s=n(1795),c=n(7462),u=n(2982),p=n(1257),f=n(3356),d=n(9352),h=n(7516),m=n(3990),E=n(9583),w=n(6087),v=function(e){var t=e.file,n=e.index,a=e.uploadProgress,l=a;return a>0&&(l=parseInt(100*a/t.size)),r.createElement("div",{className:"file-uploader-list-item"},r.createElement("div",{className:"list-item-file-info"},r.createElement("span",{className:"file-name"},t.path),r.createElement("span",{className:"file-size"},(0,w.gB)(t.size))),r.createElement("div",{className:"list-item-progress-container"},r.createElement("div",{className:"list-item-progress-bar",style:{width:l+"%"}},r.createElement("span",null,(0,w.gB)(a)))),r.createElement("div",{className:"list-item-actions"},r.createElement("a",{className:"button",onClick:function(){return e.renameFile(n)}},r.createElement(h.pUC,null)),r.createElement("a",{className:"button",onClick:function(){return e.uploadFile(n)}},r.createElement(m.bex,null)),r.createElement("a",{className:"button",onClick:function(){return e.removeFile(n)}},r.createElement(d.AWu,null))))};const g=function(e){var t=e.selectedFolder,n=e.fsep,i=(0,r.useCallback)((function(e){var t=[];for(var n in e)t[n]=null!==k?k[n]:0;C(t),F(e)}),[]),s=(0,f.uI)({onDrop:i}),d=s.getRootProps,h=s.getInputProps,m=s.isDragActive,w=(0,r.useState)(null),g=(0,l.Z)(w,2),y=g[0],F=g[1],S=(0,r.useState)(""),b=(0,l.Z)(S,2),x=b[0],N=b[1],D=(0,r.useState)(null),Z=(0,l.Z)(D,2),k=Z[0],C=Z[1],T=(0,r.useState)(!1),O=(0,l.Z)(T,2),_=O[0],P=O[1],I=(0,r.useState)(null),j=(0,l.Z)(I,2),R=j[0],A=j[1];(0,r.useEffect)((function(){null!==y&&(document.getElementById("file-uploader").offsetHeight<37*(y.length+1)?N(" w-scroll"):N(""))}),[y]),(0,r.useEffect)((function(){!0===_&&A(0)}),[_]),(0,r.useEffect)((function(){null!==R&&H(R,!0)}),[R]);var $,U,M=function(e){},L=function(e){var t=[].concat((0,u.Z)(y.slice(0,e)),(0,u.Z)(y.slice(e+1,y.length)));F(t)},H=function(a){var l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="/";null!==t&&(i="/"===t.slice(-1)?t:t+"/");var o=i+y[a].path.split(y[a].name)[0];console.log(">>>>>>>>>>>>>>>>>>>uploadFile"),console.log(t),console.log(y),console.log(o,"filePath");var r="http://".concat(window.location.hostname,":3000/upload/").concat(o.split(n).join("+++")),s=new FormData;s.append("file",y[a]);var c={onUploadProgress:function(e){var t=[].concat((0,u.Z)(k.slice(0,a)),[e.loaded],(0,u.Z)(k.slice(a+1,k.length)));C(t)}};p.Z.post(r,s,c).then((function(t){!0===l&&(a+1<y.length?A(a+1):(e.setShowFileUploader(!1),e.refreshFileManager(t.data)))}))},z=function(){var e=(0,a.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(y&&y.length>0){var V=y.map((function(e,t){return r.createElement(v,{key:t,index:t,file:e,uploadProgress:k[t],renameFile:M,removeFile:L,uploadFile:H})}));$=r.createElement("div",{id:"file-uploader-summary-list"},r.createElement("div",{id:"file-list",className:x},V),r.createElement("div",{id:"file-list-actions"},r.createElement("div",{style:{float:"right"}},r.createElement("div",{className:"upload-items-counter"},null!==R?R+" / "+y.length+" Total":""),r.createElement("a",{className:"button",onClick:function(){return e.setShowFileUploader(!1)}},"Close"),r.createElement("a",{className:"button",onClick:z}," Upload Files "))))}else U=r.createElement("div",(0,c.Z)({className:"dropzone-container"},d()),r.createElement("input",(0,c.Z)({},h(),{name:"file"})),m?r.createElement("p",null,"Drop the files here ..."):r.createElement("p",null,"Drag 'n' drop some files here, or click to select files"));return r.createElement(r.Fragment,null,r.createElement("div",{id:"file-uploader"},r.createElement("a",{className:"close-file-uploader",onClick:function(){return e.setShowFileUploader(!1)}},r.createElement(E.zYX,null)),U,$))};var y=n(1937),F=n(4597),S=n(2225);const b=function(e){var t=e.file,n=e.setShowFileViewer,i=(e.selectedFolder,(0,r.useRef)());(0,w.t$)(i,(function(){return n(!1)}));var s=t.path.split(".")[t.path.split(".").length-1],c=(0,r.useState)(null),u=(0,l.Z)(c,2),f=u[0],d=u[1],h=(0,r.useState)(!0),m=(0,l.Z)(h,2),v=m[0],g=m[1];function b(){return(b=(0,a.Z)(o().mark((function e(){var n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://".concat(window.location.hostname,":3000/json/").concat(t.path.split("/").join("+++")),{method:"GET",headers:{"Content-Type":"application/json"}});case 2:return n=e.sent,e.next=5,n.json();case 5:a=e.sent,console.log(a," GET JSON RES"),d(a),g(!1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=(0,a.Z)(o().mark((function e(n){var a,l,i,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new File([n],t.name,{type:"application/json"}),(l=new FormData).append("file",a,t.name),i=t.path.split("/home/pi")[1].split(t.name)[0],r="http://".concat(window.location.hostname,":3000/upload/").concat(i.split("/").join("+++")),p.Z.post(r,l).then((function(e){console.log("JSON UPDATED!"),console.log(e," RES ")}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,r.useEffect)((function(){"json"===s&&function(){b.apply(this,arguments)}()}),[]);var N=r.createElement(S.Z,null);return"json"===s&&!1===v&&(N=r.createElement("div",{className:"json-viewer-container"},r.createElement(y.Z,{id:t.path,placeholder:f,locale:F.Z,height:"100%",width:"100%",onChange:function(e){!function(e){x.apply(this,arguments)}(e.json)}}))),r.createElement("div",{ref:i,id:"file-viewer"},r.createElement("a",{className:"close-file-viewer",onClick:function(){return n(!1)}},r.createElement(E.zYX,null)),N)};var x=n(155),N=n(8193),D=n(5830),Z="/home/pi/",k=function(e){var t=(0,r.useContext)(D._),n=t.fileManagerState,a=t.fileManagerDispatch,i=n.browseHistory,o=n.browseHistoryIndex,c=e.getFiles,u=(0,r.useState)(!1),p=(0,l.Z)(u,2),f=p[0],d=p[1],h=(0,r.useState)(null),m=(0,l.Z)(h,2),E=m[0],v=m[1];(0,r.useEffect)((function(){setTimeout((function(){var e=document.getElementsByClassName("fa-level-up-alt")[0];e&&null!==e&&e.setAttribute("transform","scale(-1 1)");var t,n="//span[text()='Actions']";(t=document.evaluate(n,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&(t.innerText="More..."),n="//span[text()='Select all files']",(t=document.evaluate(n,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)&&(t.innerText="Select Files")}),10)}),[]);var g,y=(0,r.useRef)();function F(e){var t;"number"==typeof(t="back"===e&&n.browseHistoryIndex-1>=0?n.browseHistoryIndex-1:"forward"===e&&n.browseHistoryIndex+1<=n.browseHistory.length-1?n.browseHistoryIndex+1:e)&&a({type:"SET_SELECTED_FOLDER",payload:n.browseHistory[t],isViewingHistory:!0,browseHistoryIndex:t})}if((0,w.t$)(y,(function(){return d(!1)})),!0===f){var S=i.map((function(e,t){var n=!0;if(("back"===E&&t>o||"forward"===E&&t<o)&&(n=!1),!0===n){var a,l=e.path===Z?"zynthian":e.path.indexOf("/")>-1?e.path.split("/")[e.path.split("/").length-1]:e.path;return t===o&&(a="active"),r.createElement("li",null,r.createElement("a",{className:a,title:e.path,onClick:function(){F(t),d(!1)}},l))}}));g=r.createElement("div",{ref:y,className:"browser-history-submenu "+E},r.createElement("a",{onClick:function(){return d(!1)},className:"close-browser-history"},r.createElement(N.SV5,null)),r.createElement("ul",null,S))}var b={shouldPreventDefault:!0,delay:400},k=(0,w.TA)((function(){v("back"),d(!0)}),(function(){F("back")}),b),C=(0,w.TA)((function(){v("forward"),d(!0)}),(function(){F("forward")}),b);return r.createElement("div",{className:"file-navbar-container-custom"},r.createElement("ul",{className:"browser-navigation-menu"},r.createElement("li",null,r.createElement("a",k,r.createElement(x.O8Q,null))),r.createElement("li",null,r.createElement("a",C,r.createElement(x.qvS,null)))),g,r.createElement(s.Tn,null),r.createElement("a",{className:"refresh-button",onClick:function(){a({type:"ON_REFRESH_FILES"}),c()}},r.createElement(x.e8N,null),r.createElement("span",null,"Refresh")))};const C=function(e){var t=(0,r.useContext)(D._),n=t.fileManagerState,i=t.fileManagerDispatch,c=n.displayedFiles,u=n.selectedFolder,p=n.folderChain,f=(n.ffolder,e.fsep),d=(0,r.useState)(""),h=(0,l.Z)(d,2),m=h[0],E=h[1],w=(0,r.useState)(""),v=(0,l.Z)(w,2),y=v[0],F=v[1],x=(0,r.useState)(!1),N=(0,l.Z)(x,2),C=N[0],T=N[1],O=(0,r.useState)(!1),_=(0,l.Z)(O,2),P=_[0],I=_[1],j=(0,r.useState)(""),R=(0,l.Z)(j,2),A=R[0],$=R[1],U=(0,r.useState)(""),M=(0,l.Z)(U,2),L=M[0],H=M[1],z=(0,r.useState)(""),V=(0,l.Z)(z,2),J=V[0],Y=V[1],B=(0,r.useRef)(null);function X(){B.current&&B.current.requestFileAction(s.p$.ClearSelection)}function q(){var e=window.prompt("Enter new Folder Name:");null!==e&&function(e){G.apply(this,arguments)}((null!==u?u+f:"")+e)}function G(){return(G=(0,a.Z)(o().mark((function t(n){var a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://".concat(window.location.hostname,":3000/createfolder"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:n})});case 2:return a=t.sent,t.next=5,a.json();case 5:t.sent,e.getFiles();case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Q(e){var t=e.state.selectedFiles[0].path,n=t.split("/")[t.split("/").length-1],a=window.prompt('Enter new name for "'.concat(n,'":'),n);if(null!==a){var l=null===u?Z+a:t.split(u)[0]+u+"/"+a;i({type:"RENAME_FILE",payload:{previousPath:t,fullPath:l}}),function(e,t){W.apply(this,arguments)}(t,l)}}function W(){return(W=(0,a.Z)(o().mark((function t(n,a){var l,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://".concat(window.location.hostname,":3000/rename"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:a,previousPath:n})});case 2:return l=t.sent,t.next=5,l.json();case 5:i=t.sent,e.getFiles(i);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(e,t){return ee.apply(this,arguments)}function ee(){return ee=(0,a.Z)(o().mark((function t(n,l){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=n[l],fetch("http://".concat(window.location.hostname,":3000/delete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:i})}).then(function(){var t=(0,a.Z)(o().mark((function t(a){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l!==n.length-1){t.next=10;break}return t.next=3,a.json();case 3:t.sent,X(),I(!1),$(""),e.getFiles(),t.next=11;break;case 10:K(n,l+1);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),ee.apply(this,arguments)}function te(){return te=(0,a.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],t.state.selectedFiles.forEach((function(e,t){n.push(e.path)})),n.length>0&&($("Preparing Download"),I(!0),n.forEach(function(){var e=(0,a.Z)(o().mark((function e(t,n){var a,l,i,r,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://".concat(window.location.hostname,":3000/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:t})});case 2:return a=e.sent,e.next=5,a.blob();case 5:l=e.sent,i=window.URL.createObjectURL(l),(r=document.createElement("a")).href=i,-1===(s=t.split(f)[t.split(f).length-1]).indexOf(".zip")&&"application/zip"===l.type&&(s+=".zip"),r.download=s,document.body.appendChild(r),r.click(),r.remove(),I(!1),$("");case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function ne(e,t,n){return ae.apply(this,arguments)}function ae(){return(ae=(0,a.Z)(o().mark((function e(t,n,a){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:$("Copying Files"),I(!0),le(t,n,a,0);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e,t,n,a){return ie.apply(this,arguments)}function ie(){return ie=(0,a.Z)(o().mark((function t(n,l,r,s){var c,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("COPY PASTE FILES"),c=n[s],u=l[s],fetch("http://".concat(window.location.hostname,":3000/copypaste"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({previousPath:c,destinationPath:"/"+u,deleteOrigin:r})}).then(function(){var t=(0,a.Z)(o().mark((function t(a){var c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s!==n.length-1){t.next=11;break}return!0===r&&i({type:"DELETE_FILES",payload:n}),t.next=4,a.json();case 4:c=t.sent,X(),I(!1),$(""),e.refreshFileManager(c),t.next=12;break;case 11:le(n,l,r,s+1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)}))),ie.apply(this,arguments)}var oe,re,se,ce,ue=(0,s.S_)({id:"create_files",button:{name:"Add Folder",toolbar:!0,contextMenu:!0,icon:s.IS.folderCreate}}),pe=(0,s.S_)({id:"edit_files",button:{name:"Edit",contextMenu:!0,icon:s.IS.archive}}),fe=(0,s.S_)({id:"rename_files",button:{name:"Rename",contextMenu:!0,icon:s.IS.code}}),de=(0,s.S_)({id:"paste_files",button:{name:"Paste",contextMenu:!0,icon:s.IS.paste}}),he=(0,s.S_)({id:s.p$.UploadFiles.id,button:{name:"Upload",toolbar:!0,contextMenu:!1,icon:s.IS.upload}}),me=(0,s.S_)({id:s.p$.DownloadFiles.id,button:{name:"Download",toolbar:!0,contextMenu:!0,icon:s.IS.download}}),Ee=((0,s.S_)({id:"select_files",button:{name:"Select Files",toolbar:!1,contextMenu:!0,icon:s.IS.selectAllFiles}}),[ue,pe,fe,he,me,s.p$.DeleteFiles,s.p$.CopyFiles,s.p$.StartDragNDrop,s.p$.EndDragNDrop,de]);return!0===L&&(re=r.createElement(b,{file:J,setShowFileViewer:H,selectedFolder:u})),!0===e.showFileUploader&&(se=r.createElement(r.Fragment,null,r.createElement(g,{selectedFolder:u,fsep:f,refreshFileManager:e.refreshFileManager,setShowFileUploader:e.setShowFileUploader}))),!0!==P&&!0!==n.filesLoading||(ce=r.createElement("div",{className:"file-browser-loading-spinner-container"},r.createElement(S.Z,{text:A}))),r.createElement("div",{style:{height:window.innerHeight-170,position:"relative"},onDragOver:function(){!1===C&&(clearTimeout(oe),e.setShowFileUploader(!0))},onDragLeave:function(){oe=setTimeout((function(){e.setShowFileUploader(!1)}),10)}},ce,se,re,r.createElement(s.fy,{files:c,folderChain:p,fileActions:Ee,onFileAction:function(t){var n;t.id===s.p$.OpenFiles.id&&function(e){var t=e.payload.files[0];!0===t.isDir?i({type:"SET_SELECTED_FOLDER",payload:t}):t.path.indexOf(".")>-1&&"json"===t.path.split(".")[t.path.split(".").length-1]&&(Y(t),H(!0))}(t),t.id===ue.id&&q(),t.id===pe.id&&alert("Edit Folder Action"),t.id===fe.id&&Q(t),t.id===s.p$.UploadFiles.id&&e.setShowFileUploader(!0),t.id===s.p$.DownloadFiles.id&&function(e){te.apply(this,arguments)}(t),t.id===s.p$.DeleteFiles.id&&function(e){var t="are you sure you want to delete following files? \n",n=[];e.state.selectedFilesForAction.forEach((function(e,a){n.push(e.path),t+=e.path+"\n"})),window.confirm(t)&&($("Deleting Files"),I(!0),i({type:"DELETE_FILES",payload:n}),K(n,0))}(t),t.id===s.p$.CopyFiles.id&&function(e){var t=[];e.state.selectedFiles.forEach((function(e,n){t.push(e.path)})),E(t)}(t),t.id===de.id&&(n=[],m.forEach((function(e,t){var a=u+f;e.indexOf(".")>-1&&(a=(null!==u?u+f:"")+e.split(f)[e.split(f).length-1]),n.push(a)})),ne(m,n)),t.id===s.p$.StartDragNDrop.id&&function(e){T(!0);var t=[];e.state.selectedFiles.forEach((function(e,n){t.push(e.path)})),F(t)}(t),t.id===s.p$.EndDragNDrop.id&&function(e){T(!1);var t=[];y.forEach((function(n,a){var l="";l=null!==u?u+e.payload.destination.path.split(u)[1]:e.payload.destination.path.split(Z)[1],n.indexOf(".")>-1&&(l+=f+n.split(f)[n.split(f).length-1]).indexOf("undefined")>-1&&(l=l.split("undefined").join("")),t.push(l)})),y.length>0&&t.length>0&&y[0]!==t[0]&&ne(y,t,!0)}(t)},defaultFileViewActionId:s.p$.EnableListView.id,clearSelectionOnOutsideClick:!0,ref:B,disableDefaultFileActions:[s.p$.OpenSelection.id]},r.createElement(k,{getFiles:e.getFiles}),r.createElement(s.TY,null),r.createElement(s.mF,null),r.createElement(s.e9,{disableDefaultFileActions:[s.p$.SelectAllFiles.id]})))}}}]);