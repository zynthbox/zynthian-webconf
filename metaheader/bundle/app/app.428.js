"use strict";(self.webpackChunkzynthbox_webconf_metaheader=self.webpackChunkzynthbox_webconf_metaheader||[]).push([[428],{6087:(e,n,t)=>{t.d(n,{D9:()=>o,TA:()=>i,gB:()=>c,t$:()=>r,ut:()=>u});var l=t(885),a=t(7294);function c(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=n?1e3:1024;if(Math.abs(e)<l)return e+" B";var a=n?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],c=-1,r=Math.pow(10,t);do{e/=l,++c}while(Math.round(Math.abs(e)*r)/r>=l&&c<a.length-1);return e.toFixed(t)+" "+a[c]}function r(e,n){(0,a.useEffect)((function(){var t=function(t){e.current&&!e.current.contains(t.target)&&n(t)};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),function(){document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}}),[e,n])}function o(e){var n=(0,a.useRef)();return(0,a.useEffect)((function(){n.current=e}),[e]),n.current}var i=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=t.shouldPreventDefault,r=void 0===c||c,o=t.delay,i=void 0===o?300:o,u=(0,a.useState)(!1),m=(0,l.Z)(u,2),d=m[0],p=m[1],f=(0,a.useRef)(),E=(0,a.useRef)(),h=(0,a.useCallback)((function(n){r&&n.target&&(n.target.addEventListener("touchend",s,{passive:!1}),E.current=n.target),f.current=setTimeout((function(){e(n),p(!0)}),i)}),[e,i,r]),v=(0,a.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];f.current&&clearTimeout(f.current),t&&!d&&n(),p(!1),r&&E.current&&E.current.removeEventListener("touchend",s)}),[r,n,d]);return{onMouseDown:function(e){return h(e)},onTouchStart:function(e){return h(e)},onMouseUp:function(e){return v(e)},onMouseLeave:function(e){return v(e,!1)},onTouchEnd:function(e){return v(e)}}},s=function(e){(function(e){return"touches"in e})(e)&&e.touches.length<2&&e.preventDefault&&e.preventDefault()};function u(e){var n=Math.floor(e/60),t=e-60*n;return n<10&&(n="0"+n),(t=Math.floor(t))<10&&(t="0"+t),n+":"+t}},7428:(e,n,t)=>{t.r(n),t.d(n,{default:()=>C});var l=t(7294),a=t(8216),c=t(3557),r=t(9200),o=t(885),i=t(7830),s=t(8193),u=t(5434),m=t(6087),d=t(5861),p=t(4687),f=t.n(p);const E=function(e){var n,t,c,r=e.index,i=e.sample,s=e.channelIndex,u=e.sampleSetMode,m=e.onRemoveSample,p=e.onAddSample,E=(e.uploadSample,e.setLoadFromSketchPadSampleIndex,e.setLoadFromSketchPadFileType,e.setShowSampleSetSourcePicker,(0,l.useState)(null)),h=(0,o.Z)(E,2),v=h[0],k=h[1],y=(0,l.useState)(!1),g=(0,o.Z)(y,2),w=g[0],x=g[1];function S(){return(S=(0,d.Z)(f().mark((function e(){var n,t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=i.path.split(".").join("++")).indexOf("/")>-1&&(n=n.split("/").join("+")),e.next=4,fetch("http://".concat(window.location.hostname,":3000/").concat("sample-loop"===u?"clip":"sample","/").concat(s+1+"+++"+n),{method:"GET",headers:{"Content-Type":"application/json"}});case 4:return t=e.sent,e.next=7,t.blob();case 7:N(e.sent);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var n=new FileReader;n.addEventListener("load",(function(){var e=n.result;n.result.indexOf("data:application/octet-stream;")>-1&&(e=n.result.split(":application/octet-stream;").join(":audio/wav;")),k(e)}),!1),n.readAsDataURL(e)}function I(){x(!1),document.getElementById("sample-".concat(s+1,"-").concat(r+1,"-audio-player")).pause()}function C(e){var n=e.target;n.currentTime>=n.duration&&I()}(0,a.v9)((function(e){return e.sampleEditor})).sketchpad,(0,l.useEffect)((function(){i&&i.path&&function(){S.apply(this,arguments)}()}),[i]),i&&null!==i&&null!==i.path?(n=!0===w?l.createElement("a",{className:"play-sample-button",onClick:I},l.createElement("i",{className:"glyphicon glyphicon-pause"})):l.createElement("a",{className:"play-sample-button",onClick:function(){x(!0),document.getElementById("sample-".concat(s+1,"-").concat(r+1,"-audio-player")).play()}},l.createElement("i",{className:"glyphicon glyphicon-play-circle"})),t=l.createElement("a",{className:"edit-sample-button",onClick:function(){return m(r)}},l.createElement("i",{className:"glyphicon glyphicon-trash"}))):t=l.createElement("a",{className:"edit-sample-button",onClick:function(){return p(r)}},l.createElement("i",{className:"glyphicon glyphicon-plus"})),i&&(c=i.path?i.path:i.name)&&null!==c&&(c.indexOf("/")>-1&&(c=c.split("/")[c.split("/").length-1]),c.split(".")[0].length>16&&(c=c.substring(0,17)+"...wav"));var b,P="---";return c&&null!==c&&(P=c),null!==v&&(b=l.createElement("audio",{id:"sample-".concat(s+1,"-").concat(r+1,"-audio-player"),src:v,onTimeUpdate:function(e){return C(e)},onLoadedMetadata:function(e){return C(e)}})),l.createElement("li",{id:"sample-".concat(s+1,"-").concat(r+1)},b,n,l.createElement("h4",{title:i&&null!==c?i.path:""},P),t)};var h=t(9583),v=t(3356);const k=function(e){var n,t=e.index,o=e.samples,i=e.sampleSetMode,u=(e.keyZoneMode,(0,a.I0)()),m=(0,a.v9)((function(e){return e.sampleEditor})),d=m.sketchpad,p=m.sketchpadInfo,f=m.sourcePicker,k=m.dropZone;function y(e){"Escape"===e.key&&(u((0,c.RW)({showSourcePicker:!1})),u((0,c.i6)({showDropZone:!1})))}function g(){n=setTimeout((function(){u((0,c.i6)({showDropZone:!1}))}),10)}function w(e){u((0,c.RW)({channelIndex:t,sampleIndex:e,showSourcePicker:!0}))}function x(e,n){u((0,c.Qz)({files:[e],channelIndex:t,sampleIndex:n}))}function S(e){u((0,c.V_)({channelIndex:t,sampleIndex:e}))}(0,l.useEffect)((function(){return window.addEventListener("keydown",y,!1),function(){window.removeEventListener("keydown",y,!1)}}),[]);var N,I,C=o.map((function(e,n){return l.createElement(E,{key:n,index:n,sample:e,channelIndex:t,sampleSetMode:i,onRemoveSample:S,onAddSample:w})}));if(f.channelIndex==t&&!0===f.showSourcePicker){var b=l.createElement("a",{className:"button",onClick:function(){u((0,c.RW)({showSourcePicker:!1})),u((0,c.i6)({channelIndex:t,isSampleSet:!0,showDropZone:!0}))}},"Load from External");f.sampleIndex&&(b=l.createElement("a",{className:"button"},l.createElement("input",{type:"file",onChange:function(e){return x(e.target.files[0],f.sampleIndex)}}),"Load from External")),N=l.createElement("div",{className:"sample-set-upload-container source-picker"},l.createElement("a",{className:"close-source-picker",onClick:function(){return u((0,c.RW)({showSourcePicker:!1}))}},l.createElement(h.zYX,null)),l.createElement("a",{className:"button",onClick:function(){return e=f.sampleIndex,u((0,r.v3)({folder:p.lastSelectedSketchpad.split("".concat(d.name,".sketchpad.json"))[0],mode:"LOAD",type:e||0===e?".wav":"sample-bank.json",sampleIndex:e,channelIndex:t})),void u((0,c.RW)({showSourcePicker:!1}));var e}},"Pick from Internal"),b)}k.channelIndex==t&&!0===k.isSampleSet&&!0===k.showDropZone&&(I=l.createElement("div",{className:"sample-set-upload-container"},l.createElement("div",{className:"dropzone-container"},l.createElement(v.ZP,{onDrop:function(e){return n=e,void u((0,c.Qz)({files:n,channelIndex:t}));var n}},(function(e){var n=e.getRootProps,t=e.getInputProps;return l.createElement("section",null,l.createElement("div",n(),l.createElement("input",t()),l.createElement("p",null,"Drag 'n' drop some files here")))})))));var P="hidden";!0===k.showDropZone&&k.channelIndex==t&&0==k.isSampleSet&&(P="");var D=d.tracks[t].samples.indexOf(null);return-1==D&&(D=d.tracks[t].samples.length-1),l.createElement(l.Fragment,null,l.createElement("div",{className:"sample-list-container "+("sample-loop"===i?"show-clips":""),onDragOver:function(){clearTimeout(n),u((0,c.i6)({showDropZone:!0,channelIndex:t,isSampleSet:!1}))},onDragLeave:g},l.createElement("div",{className:"dropzone-container "+P},l.createElement(v.ZP,{onDrop:function(e){return x(e[0],D)}},(function(e){var n=e.getRootProps,t=e.getInputProps;return l.createElement("section",null,l.createElement("div",n(),l.createElement("a",{onClick:function(){return g()},className:"close-source-picker"},l.createElement(h.zYX,null)),l.createElement("input",t()),l.createElement("p",null,"Drag 'n' drop some files here")))}))),l.createElement("ul",{className:"sample-list"},C)),l.createElement("ul",{className:"sample-set-actions"},l.createElement("li",null,l.createElement("a",{onClick:function(){u((0,c.V_)({channelIndex:t}))}},l.createElement("i",{style:{marginTop:"1px"},className:"glyphicon glyphicon-trash"}))),l.createElement("li",null,l.createElement("a",{onClick:function(){}}," ",l.createElement(s.gg_,null)," ")),l.createElement("li",{style:{float:"right"}},l.createElement("a",{onClick:function(){u((0,c.RW)({channelIndex:t,showSourcePicker:!0}))}},l.createElement("i",{className:"glyphicon glyphicon-plus"})))),N,I)},y=function(e){var n=e.index,t=e.keyZoneMode,r=e.channelAudioType,o=(0,a.I0)();function i(e){o((0,c.pb)({index:n,keyZoneMode:t,channelAudioType:e}))}function s(e){o((0,c.pb)({index:n,keyzone_mode:e,channelAudioType:r}))}return l.createElement("div",{className:"track-keyzone-mode-menu"},l.createElement("div",{className:"track-audio-type-menu-container"},l.createElement("ul",null,l.createElement("li",null,l.createElement("a",{onClick:function(){return i("synth")},className:"synth"===r?"is-active":""},"Synth")),l.createElement("li",null,l.createElement("a",{onClick:function(){return i("sample-trig")},className:"sample-trig"===r?"is-active":""},"Sample")),l.createElement("li",null,l.createElement("a",{onClick:function(){return i("sample-loop")},className:"sample-loop"===r?"is-active":""},"Sketch")),l.createElement("li",null,l.createElement("a",{onClick:function(){return i("external")},className:"external"===r?"is-active":""},"External")))),l.createElement("div",{style:{opacity:"sample-trig"==r?"1":"0"},className:"keyzone-mode-menu-container"},l.createElement("span",null,"Auto Split:"),l.createElement("ul",null,l.createElement("li",null,l.createElement("a",{onClick:function(){return s("all-full")},className:"all-full"===t?"is-active":""},"Off")),l.createElement("li",null,l.createElement("a",{onClick:function(){return s("split-full")},className:"split-full"===t?"is-active":""},"Auto")),l.createElement("li",null,l.createElement("a",{onClick:function(){return s("split-narrow")},className:"split-narrow"===t?"is-active":""},"Narrow")))))};var g=t(7516);const w=function(e){var n=e.showEditMode,t=e.setShowEditMode,r=e.title,i=e.index,s=(0,a.I0)(),u=(0,l.useState)(r),d=(0,o.Z)(u,2),p=d[0],f=d[1],E=(0,l.useRef)(null),h=(0,l.useRef)(null);function v(e){"Escape"===e.key?E.current.click():"Enter"===e.key&&h.current.click()}(0,l.useEffect)((function(){return window.removeEventListener("keydown",v,!1),window.addEventListener("keydown",v,!1),function(){window.removeEventListener("keydown",v,!1)}}),[r]),(0,l.useEffect)((function(){!0===n&&f(r)}),[n]);var k=(0,l.useRef)();(0,m.t$)(k,(function(e){"edit-button"!==e.target.className&&t(!1)}));var y,w=null===r?"Track ".concat(i+1):r;return y=!0===n?l.createElement("div",{className:"input-wrapper"},l.createElement("input",{type:"text",placeholder:"",value:r,onChange:function(e){return s((0,c.f2)({index:i,title:e.target.value}))},autoFocus:!0}),l.createElement("a",{ref:E,className:"undo-title-change",onClick:function(){s((0,c.f2)({index:i,title:p})),t(!1)}},l.createElement(g.V3h,null)),l.createElement("a",{ref:h,className:"save-changes",onClick:function(){return f(r),void t(!1)}})):l.createElement("h2",null,w),l.createElement("div",{className:"sample-set-title"},l.createElement("div",{ref:k,className:"title-wrapper"},y))},x=function(e){var n,t=(0,a.I0)(),r=e.index,d=e.channel,p=e.color,f=(0,l.useState)(!1),E=(0,o.Z)(f,2),h=E[0],v=E[1],g=(0,l.useState)(!1),x=(0,o.Z)(g,2),S=x[0],N=x[1],I=(0,l.useRef)();return(0,m.t$)(I,(function(){return N(!1)})),!0===S&&(n=l.createElement("div",{className:"color-picker-container"},l.createElement(i.xS,{color:p,onChange:function(e){return t((0,c.Eh)({index:r,color:e.hex}))}}))),l.createElement(l.Fragment,null,l.createElement("div",{className:"sample-set",style:{backgroundColor:e.color}},l.createElement("div",{ref:I,className:"edit-menu-container"},l.createElement("ul",{className:"edit-menu"},l.createElement("li",null,l.createElement("a",{className:"edit-button",onClick:function(){return v(1!=h)}},l.createElement(u.rnx,null),l.createElement("span",{className:"edit-button"}))),l.createElement("li",null,l.createElement("a",{className:"color-picker",onClick:function(){return N(1!=S)}},l.createElement(s.R8K,null)))),n),l.createElement(w,{showEditMode:h,title:d.name,index:r,setShowEditMode:v}),l.createElement(y,{index:r,keyZoneMode:d.keyzone_mode,channelAudioType:d.channelAudioType}),l.createElement(k,{index:r,samples:"sample-loop"===d.channelAudioType?d.clips:d.samples,sampleSetMode:d.channelAudioType,keyZoneMode:d.keyzone_mode})))};var S=t(4578),N=t(3750);const I=function(e){var n=(0,a.I0)(),t=(0,a.v9)((function(e){return e.filePicker})),c=t.folder,i=t.initFolder,u=t.mode,d=t.files,p=t.selectedFile,f=t.type,E=t.channelIndex,v=t.sampleIndex,k=(0,l.useState)(""),y=(0,o.Z)(k,2),g=y[0],w=y[1];(0,l.useEffect)((function(){null!==c&&n((0,r.v0)())}),[c]);var x=(0,l.useRef)();function I(t){n((0,r.Fz)()),e.onSelectFile(t,E,v)}(0,m.t$)(x,(function(e){n((0,r.Fz)())}));var C,b="sample-set-load-from-sketch-pad-dialog";"SAVE"===u&&(b+=" w-save",C=l.createElement("div",{className:"dialog-footer"},l.createElement("input",{value:g,onChange:function(e){return w(e.target.value)},type:"text"}),l.createElement("button",{onClick:function(){I(c+g+f)}},"Save")));var P,D=l.createElement("li",null,l.createElement("a",null,"No files of type ".concat(f," were found")));return null!==d&&d.length>0&&(D=d.map((function(e,t){var a=l.createElement(s.On3,null),c="folder";return!1===e.isDir&&(a="wav"===(c=e.name.split(".")[e.name.split(".").length-1])?l.createElement(N.QEW,null):"json"===c?l.createElement(S.gkd,null):l.createElement(N.b0A,null)),l.createElement("li",{key:t},l.createElement("a",{onClick:function(){return n((0,r.KF)(e.name))},className:e.name===p?"active":"",onDoubleClick:function(){return function(e,t){"folder"===t||"cache"===t?n((0,r.I1)(e.path+"/")):I(e)}(e,c)}},a," ",e.name))}))),c!==i&&(P=l.createElement("li",null,l.createElement("a",{onDoubleClick:function(){return e=c.split("/")[c.split("/").length-2]+"/",t=c.split(e)[0],void n((0,r.I1)(t));var e,t}},l.createElement(s.y6u,null),"..."))),l.createElement("div",{ref:x,className:b},l.createElement("a",{className:"close",onClick:function(){return n((0,r.Fz)())}},l.createElement(h.zYX,null)),l.createElement("h4",null,u," FROM SKETCH PAD"),l.createElement("ul",null,P,D),C)},C=function(e){var n,t=e.colorsArray,o=(0,a.v9)((function(e){return e.sampleEditor})),i=o.sketchpadInfo,s=o.sketchpad,u=o.pendingFiles,m=(0,a.v9)((function(e){return e.filePicker})),d=m.showFilePicker,p=m.mode,f=m.type,E=(0,a.I0)();if((0,l.useEffect)((function(){E((0,c.l1)())}),[]),(0,l.useEffect)((function(){null!==i&&E((0,c.si)())}),[i]),(0,l.useEffect)((function(){if(null!==u.files){var e=u.files,n=u.channelIndex;E((0,c.qR)({files:e,channelIndex:n}))}}),[u]),null!==s){var h=i.lastSelectedSketchpad,v=h.split("/")[h.split("/").length-1],k=h.split(v)[0];k.indexOf("/zynthian/")>-1&&(k="/"+k.split("/zynthian/")[1]),n=s.tracks.map((function(e,n){return l.createElement(x,{key:n,index:n,color:e.color&&"#000000"!==e.color?e.color:t[n],channel:e})}))}var y,g={height:window.innerHeight-165};return window.innerHeight<865&&(g["overflow-y"]="scroll"),!0===d&&(y=l.createElement(I,{onSelectFile:function(e,n,t){if(".sketchpad.json"===f)if("SAVE"===p){var l=e,a=l.split("/")[l.split("/").length-1].split(".sketchpad.json")[0];E((0,c.R5)("/"+l.split("/zynthian/")[1])),E((0,c.UE)({filePath:l,fileName:a}))}else{var r=e;E((0,c.UE)({filePath:r.path,fileName:r.name}))}else".wav"===f?"LOAD"===p&&E((0,c.qR)({files:[e],channelIndex:n,sampleIndex:t})):"sample-bank.json"===f&&"LOAD"===p&&E((0,c.jO)({sampleSet:e,channelIndex:n}))}})),l.createElement(l.Fragment,null,l.createElement("div",{className:"sample-editor-menu"},l.createElement("ul",null,l.createElement("li",null,l.createElement("a",null,"New")),l.createElement("li",null,l.createElement("a",{onClick:function(){return e=i.lastSelectedSketchpad.split(s.name)[0],void E((0,r.v3)({folder:e,mode:"LOAD",type:".sketchpad.json"}));var e}},"Load")),l.createElement("li",null,l.createElement("a",{onClick:function(){return E((0,c.R5)())}},"Save")),l.createElement("li",null,l.createElement("a",{onClick:function(){var e;e=i.lastSelectedSketchpad.split("".concat(s.name,".sketchpad.json"))[0],E((0,r.v3)({folder:e,mode:"SAVE",type:".sketchpad.json"}))}},"Save As...")),null!==i?l.createElement("li",{style:{float:"right"}},l.createElement("a",null,i.lastSelectedSketchpad)):"")),l.createElement("div",{id:"sample-editor",style:g},n),y)}}}]);