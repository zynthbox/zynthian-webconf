"use strict";(self.webpackChunkzynthbox_webconf_metaheader=self.webpackChunkzynthbox_webconf_metaheader||[]).push([[614],{6338:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(7294),o=n(2225),a=n(5509),i=n(7842),s=n(7462),l=n(885),c=n(3356),u=n(1257);const p={repeatCount:-1,stereoSeparation:100,interpolationFilter:0,context:!1};class f{constructor(e){if(this.config={...p,...e},this.config.context){if(!this.config.context.destination)throw"ChiptuneJsPlayer: This is not an audio context";this.context=this.config.context,this.destination=!1}else this.context=new AudioContext,this.destination=this.context.destination;delete this.config.context,this.gain=this.context.createGain(),this.gain.gain.value=1,this.handlers=[],this.context.audioWorklet.addModule(new URL(n(1089),n.b)).then((()=>{this.processNode=new AudioWorkletNode(this.context,"libopenmpt-processor",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[2]}),this.processNode.port.onmessage=this.handleMessage_.bind(this),this.processNode.port.postMessage({cmd:"config",val:this.config}),this.fireEvent("onInitialized"),this.processNode.connect(this.gain),this.destination&&this.gain.connect(this.destination)})).catch((e=>console.error(e)))}handleMessage_(e){switch(e.data.cmd){case"meta":this.meta=e.data.meta,this.duration=e.data.meta.dur,this.fireEvent("onMetadata",this.meta);break;case"pos":this.currentTime=e.data.pos,this.order=e.data.order,this.pattern=e.data.pattern,this.row=e.data.row,this.fireEvent("onProgress",e.data);break;case"end":this.fireEvent("onEnded");break;case"err":this.fireEvent("onError",{type:e.data.val});break;default:console.log("Received unknown message",e.data)}}fireEvent(e,t){const n=this.handlers;n.length&&n.forEach((function(n){n.eventName===e&&n.handler(t)}))}addHandler(e,t){this.handlers.push({eventName:e,handler:t})}onInitialized(e){this.addHandler("onInitialized",e)}onEnded(e){this.addHandler("onEnded",e)}onError(e){this.addHandler("onError",e)}onMetadata(e){this.addHandler("onMetadata",e)}onProgress(e){this.addHandler("onProgress",e)}postMsg(e,t){this.processNode&&this.processNode.port.postMessage({cmd:e,val:t})}load(e){fetch(e).then((e=>e.arrayBuffer())).then((e=>this.play(e))).catch((e=>{this.fireEvent("onError",{type:"Load"})}))}play(e){this.postMsg("play",e)}stop(){this.postMsg("stop")}pause(){this.postMsg("pause")}unpause(){this.postMsg("unpause")}togglePause(){this.postMsg("togglePause")}setRepeatCount(e){this.postMsg("repeatCount",e)}setPitch(e){this.postMsg("setPitch",e)}setTempo(e){this.postMsg("setTempo",e)}setPos(e){this.postMsg("setPos",e)}setOrderRow(e,t){this.postMsg("setOrderRow",{o:e,r:t})}setVol(e){this.gain.gain.value=e}selectSubsong(e){this.postMsg("selectSubsong",e)}seek(e){this.setPos(e)}getCurrentTime(){return this.currentTime}}const d=function(){var e=(0,r.useState)(null),t=(0,l.Z)(e,2),n=t[0],o=t[1],a=(0,r.useState)(null),i=(0,l.Z)(a,2),p=i[0],d=i[1],h=(0,r.useState)(null),y=(0,l.Z)(h,2),m=y[0],g=y[1],b=(0,r.useState)(null),v=(0,l.Z)(b,2),O=v[0],E=v[1],w=(0,r.useState)(!1),P=(0,l.Z)(w,2),j=P[0],x=P[1],S=(0,r.useState)(""),D=(0,l.Z)(S,2),C=D[0],Z=D[1],k=(0,r.useRef)(null);(0,r.useEffect)((function(){k.current=new f,k.current.onInitialized((function(){}))}),[]),(0,r.useEffect)((function(){null!==n&&_()}),[n]);var _=function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;k.current.play(t)},t.readAsArrayBuffer(n[0]),k.current.onMetadata((function(e){console.log(e.song),e.song="too large to display this way...",Z(JSON.stringify(e).replace(/,/g,"<br/>&nbsp;&nbsp;"))})),x(!0)},M=(0,r.useCallback)((function(e){o(e)}),[]),F=(0,c.uI)({onDrop:M}),H=F.getRootProps,I=F.getInputProps,N=F.isDragActive,R=null;return m&&(R=r.createElement("ul",{className:"sample-list"},m.map((function(e,t){return r.createElement("li",{key:t},r.createElement("a",{onClick:function(){!function(e){var t="http://".concat(window.location.hostname,":3000/play-sample/").concat(O+"+++"+e);u.Z.get(t).then((function(e){}))}(e)}},e," "))})))),r.createElement("div",{className:"module-container"},r.createElement("div",(0,s.Z)({className:"dropzone-container"},H()),r.createElement("input",(0,s.Z)({},I(),{name:"file"})),N?r.createElement("p",null,"Drop a file[it, xm, s3m, mod, umx, mptm] here ..."):r.createElement("p",null,"Drag 'n' drop a file[it, xm, s3m, mod, umx, mptm] here, or click to select file")),r.createElement("div",null,n&&r.createElement(r.Fragment,null,r.createElement("button",{onClick:function(){k.current.togglePause(),x(!j)}},j?"Pause":"Play"),r.createElement("button",{onClick:function(){var e="http://".concat(window.location.hostname,":3000/tracker-info/").concat(n[0].name),t=new FormData;t.append("file",n[0]),u.Z.post(e,t,{}).then((function(e){d(e.data.message),g(e.data.samples),E(e.data.path)}))}}," Extract Samples "))),C&&r.createElement("div",{className:"metadata",dangerouslySetInnerHTML:{__html:C}}),r.createElement("ul",{className:"file-info"},p),r.createElement("div",{className:"sample-container"},R))};var h=(0,r.lazy)((function(){return Promise.all([n.e(545),n.e(773)]).then(n.bind(n,8773))}));const y=function(){return r.createElement(r.Fragment,null,r.createElement(a.Z,{className:"split"},r.createElement("div",null,r.createElement("div",{id:"file-manager"},r.createElement(i.Z,null,r.createElement(r.Suspense,{fallback:r.createElement(o.Z,null)},r.createElement(h,null))))),r.createElement("div",null,r.createElement(d,null))))}},7842:(e,t,n)=>{n.d(t,{_:()=>O,Z:()=>w});var r=n(7462),o=n(885),a=n(7294),i=n(4942),s=n(2982),l=n(7259);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n,r){var o=[];return e.forEach((function(a,i){if(a.folder===r){var s=u(u({},a),{},{toggled:t.findIndex((function(e){return e.path===a.path}))>-1});l.E+n===a.path&&(s.active=!0),e.filter((function(e){return e.level>a.level})).length>0&&(s.children=p(e.filter((function(e){return e.level>a.level})),t,n,a.path+"/")),o.push(s)}})),o}function f(e,t,n){return{name:"zynthian",toggled:!0,path:"/home/pi",active:null===n,children:p(e,t,n,l.E)}}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g="/home/pi/zynthian-my-data/samples/",b={loading:!0,filesLoading:!1,selectedFolder:null,files:[],displayedFiles:[],folderChain:[{id:"xcv",name:"zynthian",alias:"/home/pi/zynthian-my-data/samples/",isDir:!0}],browseHistory:[{id:"xcv",isDir:!0,label:g,name:g,path:g}],browseHistoryIndex:0,treeData:null,error:null};const v=function(e,t){switch(t.type){case"SET_SELECTED_FOLDER":var n=t.payload,r=n.name;n.alias&&(r=n.alias);var o,a,i=!1;if(e.folderChain.forEach((function(e,t){e.id===n.id&&(i=!0)})),i){o=r===g?null:e.selectedFolder.split(r)[0]+r;var c=e.folderChain.findIndex((function(e){return e.id===n.id}));a=(0,s.Z)(e.folderChain.slice(0,c+1))}else if(null!==e.selectedFolder){var u=n.path.split(g)[1];u&&-1===u.indexOf(e.selectedFolder)?(o=u,a=[].concat((0,s.Z)(b.folderChain),(0,s.Z)(function(e,t){for(var n=[],r=l.E,o=e.split("/"),a=0;a<o.length;a++){var i=t.filter((function(e){return e.path===r+o[a]}))[0];n.push(h(h({},i),{},{id:i.folder+i.name})),r+=o[a]+"/"}return n}(u,e.files)))):(o=e.selectedFolder+"/"+r,a=[].concat((0,s.Z)(e.folderChain),[n]))}else o=r,a=[].concat((0,s.Z)(e.folderChain),[n]);var p,d=(0,s.Z)(e.browseHistory);return p=!0===t.isViewingHistory?t.browseHistoryIndex:(d=e.browseHistoryIndex!==e.browseHistory.length-1?[].concat((0,s.Z)(e.browseHistory.slice(0,e.browseHistoryIndex+1)),[m(m({},n),{},{path:n.path?n.path:g})]):[].concat((0,s.Z)(e.browseHistory),[m(m({},n),{},{path:n.path?n.path:g})])).length-1,m(m({},e),{},{selectedFolder:o,folderChain:a,browseHistory:d,browseHistoryIndex:p});case"SET_FILES":var y,v=function(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var r=n+1;r<t.length;++r)t[n].path===t[r].path&&t.splice(r--,1);return t}(t.payload.concat(e.files));y=t.payload.map((function(e){return m(m({},e),{},{id:e.path})}));var O=f(v.filter((function(e){return!0===e.isDir})),e.folderChain,e.selectedFolder);return m(m({},e),{},{files:v,displayedFiles:y,treeData:O,loading:!1,filesLoading:!1});case"RENAME_FILE":var E=t.payload,w=E.previousPath,P=(E.fullPath,e.files.filter((function(e){return-1===e.path.indexOf(w)}))),j=f(P.filter((function(e){return!0===e.isDir})),e.folderChain,e.selectedFolder);return m(m({},e),{},{files:P,treeData:j});case"DELETE_FILES":var x=t.payload,S=e.files.filter((function(e){var t=!0;return x.forEach((function(n,r){e.path.indexOf(n)>-1&&(t=!1)})),t})),D=f(S.filter((function(e){return!0===e.isDir})),e.folderChain,e.selectedFolder);return m(m({},e),{},{files:S,treeData:D});case"SET_ERROR":var C=t.payload;return m(m({},e),{},{error:C});case"ON_REFRESH_FILES":return m(m({},e),{},{filesLoading:!0})}};var O=a.createContext(),E=O.Provider;const w=function(e){var t=a.useReducer(v,b),n=(0,o.Z)(t,2),i=n[0],s=n[1];return a.createElement(E,(0,r.Z)({},e,{value:{fileManagerState:i,fileManagerDispatch:s}}))}},7259:(e,t,n)=>{n.d(t,{E:()=>r});var r="/home/pi/zynthian-my-data/samples/"},1089:(e,t,n)=>{e.exports=n.p+"175a1379d61a170a5668.js"},7582:(e,t,n)=>{n.d(t,{CR:()=>c,Jh:()=>l,ZT:()=>o,_T:()=>i,ev:()=>u,mG:()=>s,pi:()=>a});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)};function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function c(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function u(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError}}]);