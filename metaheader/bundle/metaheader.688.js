"use strict";(self.webpackChunkzynthbox_webconf_metaheader=self.webpackChunkzynthbox_webconf_metaheader||[]).push([[688],{4688:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var a=n(5861),l=n(885),i=n(4687),r=n.n(i),o=n(7294),s=n(1795),c=n(7462),u=n(2982),p=n(1257),f=n(3356),d=n(9352),h=n(7516),m=n(3990),E=n(9583),w=n(6087),v=function(e){var t=e.file,n=e.index,a=e.uploadProgress,l=a;return a>0&&(l=parseInt(100*a/t.size)),o.createElement("div",{className:"file-uploader-list-item"},o.createElement("div",{className:"list-item-file-info"},o.createElement("span",{className:"file-name"},t.path),o.createElement("span",{className:"file-size"},(0,w.gB)(t.size))),o.createElement("div",{className:"list-item-progress-container"},o.createElement("div",{className:"list-item-progress-bar",style:{width:l+"%"}},o.createElement("span",null,(0,w.gB)(a)))),o.createElement("div",{className:"list-item-actions"},o.createElement("a",{className:"button",onClick:function(){return e.renameFile(n)}},o.createElement(h.pUC,null)),o.createElement("a",{className:"button",onClick:function(){return e.uploadFile(n)}},o.createElement(m.bex,null)),o.createElement("a",{className:"button",onClick:function(){return e.removeFile(n)}},o.createElement(d.AWu,null))))};const y=function(e){var t=e.selectedFolder,n=e.fsep,i=(0,o.useCallback)((function(e){var t=[];for(var n in e)t[n]=null!==k?k[n]:0;C(t),F(e)}),[]),s=(0,f.uI)({onDrop:i}),d=s.getRootProps,h=s.getInputProps,m=s.isDragActive,w=(0,o.useState)(null),y=(0,l.Z)(w,2),g=y[0],F=y[1],S=(0,o.useState)(""),b=(0,l.Z)(S,2),x=b[0],N=b[1],D=(0,o.useState)(null),Z=(0,l.Z)(D,2),k=Z[0],C=Z[1],T=(0,o.useState)(!1),O=(0,l.Z)(T,2),_=O[0],P=O[1],I=(0,o.useState)(null),j=(0,l.Z)(I,2),R=j[0],A=j[1];(0,o.useEffect)((function(){null!==g&&(document.getElementById("file-uploader").offsetHeight<37*(g.length+1)?N(" w-scroll"):N(""))}),[g]),(0,o.useEffect)((function(){!0===_&&A(0)}),[_]),(0,o.useEffect)((function(){null!==R&&H(R,!0)}),[R]);var $,U,M=function(e){},L=function(e){var t=[].concat((0,u.Z)(g.slice(0,e)),(0,u.Z)(g.slice(e+1,g.length)));F(t)},H=function(a){var l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i="/";null!==t&&(i="/"===t.slice(-1)?t:t+"/");var r=i+g[a].path.split(g[a].name)[0],o="http://".concat(window.location.hostname,":3000/upload/").concat(r.split(n).join("+++")),s=new FormData;s.append("file",g[a]);var c={onUploadProgress:function(e){var t=[].concat((0,u.Z)(k.slice(0,a)),[e.loaded],(0,u.Z)(k.slice(a+1,k.length)));C(t)}};p.Z.post(o,s,c).then((function(t){!0===l&&(a+1<g.length?A(a+1):(e.setShowFileUploader(!1),e.refreshFileManager(t.data)))}))},z=function(){var e=(0,a.Z)(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:P(!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(g&&g.length>0){var V=g.map((function(e,t){return o.createElement(v,{key:t,index:t,file:e,uploadProgress:k[t],renameFile:M,removeFile:L,uploadFile:H})}));$=o.createElement("div",{id:"file-uploader-summary-list"},o.createElement("div",{id:"file-list",className:x},V),o.createElement("div",{id:"file-list-actions"},o.createElement("div",{style:{float:"right"}},o.createElement("div",{className:"upload-items-counter"},null!==R?R+" / "+g.length+" Total":""),o.createElement("a",{className:"button",onClick:function(){return e.setShowFileUploader(!1)}},"Close"),o.createElement("a",{className:"button",onClick:z}," Upload Files "))))}else U=o.createElement("div",(0,c.Z)({className:"dropzone-container"},d()),o.createElement("input",(0,c.Z)({},h(),{name:"file"})),m?o.createElement("p",null,"Drop the files here ..."):o.createElement("p",null,"Drag 'n' drop some files here, or click to select files"));return o.createElement(o.Fragment,null,o.createElement("div",{id:"file-uploader"},o.createElement("a",{className:"close-file-uploader",onClick:function(){return e.setShowFileUploader(!1)}},o.createElement(E.zYX,null)),U,$))};var g=n(1937),F=n(4597),S=n(2225);const b=function(e){var t=e.file,n=e.setShowFileViewer,i=(e.selectedFolder,(0,o.useRef)());(0,w.t$)(i,(function(){return n(!1)}));var s=t.path.split(".")[t.path.split(".").length-1],c=(0,o.useState)(null),u=(0,l.Z)(c,2),f=u[0],d=u[1],h=(0,o.useState)(!0),m=(0,l.Z)(h,2),v=m[0],y=m[1];function b(){return(b=(0,a.Z)(r().mark((function e(){var n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://".concat(window.location.hostname,":3000/json/").concat(t.path.split("/").join("+++")),{method:"GET",headers:{"Content-Type":"application/json"}});case 2:return n=e.sent,e.next=5,n.json();case 5:a=e.sent,console.log(a," GET JSON RES"),d(a),y(!1);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=(0,a.Z)(r().mark((function e(n){var a,l,i,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new File([n],t.name,{type:"application/json"}),(l=new FormData).append("file",a,t.name),i=t.path.split("/home/pi")[1].split(t.name)[0],o="http://".concat(window.location.hostname,":3000/upload/").concat(i.split("/").join("+++")),p.Z.post(o,l).then((function(e){console.log("JSON UPDATED!"),console.log(e," RES ")}));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,o.useEffect)((function(){"json"===s&&function(){b.apply(this,arguments)}()}),[]);var N=o.createElement(S.Z,null);return"json"===s&&!1===v&&(N=o.createElement("div",{className:"json-viewer-container"},o.createElement(g.Z,{id:t.path,placeholder:f,locale:F.Z,height:"100%",width:"100%",onChange:function(e){!function(e){x.apply(this,arguments)}(e.json)}}))),o.createElement("div",{ref:i,id:"file-viewer"},o.createElement("a",{className:"close-file-viewer",onClick:function(){return n(!1)}},o.createElement(E.zYX,null)),N)};var x=n(155),N=n(8193),D=n(5830),Z=function(e){var t=(0,o.useContext)(D._),n=t.fileManagerState,a=t.fileManagerDispatch,i=n.browseHistory,r=n.browseHistoryIndex,c=e.getFiles,u=(0,o.useState)(!1),p=(0,l.Z)(u,2),f=p[0],d=p[1],h=(0,o.useState)(null),m=(0,l.Z)(h,2),E=m[0],v=m[1];(0,o.useEffect)((function(){setTimeout((function(){var e=document.getElementsByClassName("fa-level-up-alt")[0];e&&null!==e&&e.setAttribute("transform","scale(-1 1)");var t="//span[text()='Actions']";document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.innerText="More...",t="//span[text()='Select all files']",document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.innerText="Select Files"}),10)}),[]);var y,g=(0,o.useRef)();function F(e){var t;"number"==typeof(t="back"===e&&n.browseHistoryIndex-1>=0?n.browseHistoryIndex-1:"forward"===e&&n.browseHistoryIndex+1<=n.browseHistory.length-1?n.browseHistoryIndex+1:e)&&a({type:"SET_SELECTED_FOLDER",payload:n.browseHistory[t],isViewingHistory:!0,browseHistoryIndex:t})}if((0,w.t$)(g,(function(){return d(!1)})),!0===f){var S=i.map((function(e,t){var n=!0;if(("back"===E&&t>r||"forward"===E&&t<r)&&(n=!1),!0===n){var a,l="/home/pi/"===e.path?"zynthian":e.path.indexOf("/")>-1?e.path.split("/")[e.path.split("/").length-1]:e.path;return t===r&&(a="active"),o.createElement("li",null,o.createElement("a",{className:a,title:e.path,onClick:function(){F(t),d(!1)}},l))}}));y=o.createElement("div",{ref:g,className:"browser-history-submenu "+E},o.createElement("a",{onClick:function(){return d(!1)},className:"close-browser-history"},o.createElement(N.SV5,null)),o.createElement("ul",null,S))}var b={shouldPreventDefault:!0,delay:400},Z=(0,w.TA)((function(){v("back"),d(!0)}),(function(){F("back")}),b),k=(0,w.TA)((function(){v("forward"),d(!0)}),(function(){F("forward")}),b);return o.createElement("div",{className:"file-navbar-container-custom"},o.createElement("ul",{className:"browser-navigation-menu"},o.createElement("li",null,o.createElement("a",Z,o.createElement(x.O8Q,null))),o.createElement("li",null,o.createElement("a",k,o.createElement(x.qvS,null)))),y,o.createElement(s.Tn,null),o.createElement("a",{className:"refresh-button",onClick:function(){a({type:"ON_REFRESH_FILES"}),c()}},o.createElement(x.e8N,null),o.createElement("span",null,"Refresh")))};const k=function(e){var t=(0,o.useContext)(D._),n=t.fileManagerState,i=t.fileManagerDispatch,c=n.displayedFiles,u=n.selectedFolder,p=n.folderChain,f=(n.ffolder,e.fsep),d=(0,o.useState)(""),h=(0,l.Z)(d,2),m=h[0],E=h[1],w=(0,o.useState)(""),v=(0,l.Z)(w,2),g=v[0],F=v[1],x=(0,o.useState)(!1),N=(0,l.Z)(x,2),k=N[0],C=N[1],T=(0,o.useState)(!1),O=(0,l.Z)(T,2),_=O[0],P=O[1],I=(0,o.useState)(""),j=(0,l.Z)(I,2),R=j[0],A=j[1],$=(0,o.useState)(""),U=(0,l.Z)($,2),M=U[0],L=U[1],H=(0,o.useState)(""),z=(0,l.Z)(H,2),V=z[0],J=z[1],Y=(0,o.useRef)(null);function B(){Y.current&&Y.current.requestFileAction(s.p$.ClearSelection)}function X(){var e=window.prompt("Enter new Folder Name:");null!==e&&function(e){q.apply(this,arguments)}((null!==u?u+f:"")+e)}function q(){return(q=(0,a.Z)(r().mark((function t(n){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://".concat(window.location.hostname,":3000/createfolder"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:n})});case 2:return a=t.sent,t.next=5,a.json();case 5:t.sent,e.getFiles();case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function G(e){var t=e.state.selectedFiles[0].path,n=t.split("/")[t.split("/").length-1],a=window.prompt('Enter new name for "'.concat(n,'":'),n);if(null!==a){var l=null===u?"/home/pi/"+a:t.split(u)[0]+u+"/"+a;i({type:"RENAME_FILE",payload:{previousPath:t,fullPath:l}}),function(e,t){Q.apply(this,arguments)}(t,l)}}function Q(){return(Q=(0,a.Z)(r().mark((function t(n,a){var l,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://".concat(window.location.hostname,":3000/rename"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:a,previousPath:n})});case 2:return l=t.sent,t.next=5,l.json();case 5:i=t.sent,e.getFiles(i);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function W(e,t){return K.apply(this,arguments)}function K(){return K=(0,a.Z)(r().mark((function t(n,l){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=n[l],fetch("http://".concat(window.location.hostname,":3000/delete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fullPath:i})}).then(function(){var t=(0,a.Z)(r().mark((function t(a){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l!==n.length-1){t.next=10;break}return t.next=3,a.json();case 3:t.sent,B(),P(!1),A(""),e.getFiles(),t.next=11;break;case 10:W(n,l+1);case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)}))),K.apply(this,arguments)}function ee(){return ee=(0,a.Z)(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],t.state.selectedFiles.forEach((function(e,t){n.push(e.path)})),n.length>0&&(A("Preparing Download"),P(!0),n.forEach(function(){var e=(0,a.Z)(r().mark((function e(t,n){var a,l,i,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://".concat(window.location.hostname,":3000/download"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:t})});case 2:return a=e.sent,e.next=5,a.blob();case 5:l=e.sent,i=window.URL.createObjectURL(l),(o=document.createElement("a")).href=i,-1===(s=t.split(f)[t.split(f).length-1]).indexOf(".zip")&&"application/zip"===l.type&&(s+=".zip"),o.download=s,document.body.appendChild(o),o.click(),o.remove(),P(!1),A("");case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e,t,n){return ne.apply(this,arguments)}function ne(){return(ne=(0,a.Z)(r().mark((function e(t,n,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A("Copying Files"),P(!0),console.log(t,n),ae(t,n,a,0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t,n,a){return le.apply(this,arguments)}function le(){return le=(0,a.Z)(r().mark((function t(n,l,o,s){var c,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("COPY PASTE FILES"),c=n[s],u=l[s],fetch("http://".concat(window.location.hostname,":3000/copypaste"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({previousPath:c,destinationPath:"/"+u,deleteOrigin:o})}).then(function(){var t=(0,a.Z)(r().mark((function t(a){var c;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s!==n.length-1){t.next=11;break}return!0===o&&i({type:"DELETE_FILES",payload:n}),t.next=4,a.json();case 4:c=t.sent,B(),P(!1),A(""),e.refreshFileManager(c),t.next=12;break;case 11:ae(n,l,o,s+1);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)}))),le.apply(this,arguments)}var ie,re,oe,se,ce=(0,s.S_)({id:"create_files",button:{name:"Add Folder",toolbar:!0,contextMenu:!0,icon:s.IS.folderCreate}}),ue=(0,s.S_)({id:"edit_files",button:{name:"Edit",contextMenu:!0,icon:s.IS.archive}}),pe=(0,s.S_)({id:"rename_files",button:{name:"Rename",contextMenu:!0,icon:s.IS.code}}),fe=(0,s.S_)({id:"paste_files",button:{name:"Paste",contextMenu:!0,icon:s.IS.paste}}),de=(0,s.S_)({id:s.p$.UploadFiles.id,button:{name:"Upload",toolbar:!0,contextMenu:!1,icon:s.IS.upload}}),he=(0,s.S_)({id:s.p$.DownloadFiles.id,button:{name:"Download",toolbar:!0,contextMenu:!0,icon:s.IS.download}}),me=((0,s.S_)({id:"select_files",button:{name:"Select Files",toolbar:!1,contextMenu:!0,icon:s.IS.selectAllFiles}}),[ce,ue,pe,de,he,s.p$.DeleteFiles,s.p$.CopyFiles,s.p$.StartDragNDrop,s.p$.EndDragNDrop,fe]);return!0===M&&(re=o.createElement(b,{file:V,setShowFileViewer:L,selectedFolder:u})),!0===e.showFileUploader&&(oe=o.createElement(o.Fragment,null,o.createElement(y,{selectedFolder:u,fsep:f,refreshFileManager:e.refreshFileManager,setShowFileUploader:e.setShowFileUploader}))),!0!==_&&!0!==n.filesLoading||(se=o.createElement("div",{className:"file-browser-loading-spinner-container"},o.createElement(S.Z,{text:R}))),o.createElement("div",{style:{height:window.innerHeight-170,position:"relative"},onDragOver:function(){!1===k&&(clearTimeout(ie),e.setShowFileUploader(!0))},onDragLeave:function(){ie=setTimeout((function(){e.setShowFileUploader(!1)}),10)}},se,oe,re,o.createElement(s.fy,{files:c,folderChain:p,fileActions:me,onFileAction:function(t){var n;t.id===s.p$.OpenFiles.id&&function(e){var t=e.payload.files[0];!0===t.isDir?i({type:"SET_SELECTED_FOLDER",payload:t}):t.path.indexOf(".")>-1&&"json"===t.path.split(".")[t.path.split(".").length-1]&&(J(t),L(!0))}(t),t.id===ce.id&&X(),t.id===ue.id&&alert("Edit Folder Action"),t.id===pe.id&&G(t),t.id===s.p$.UploadFiles.id&&e.setShowFileUploader(!0),t.id===s.p$.DownloadFiles.id&&function(e){ee.apply(this,arguments)}(t),t.id===s.p$.DeleteFiles.id&&function(e){var t="are you sure you want to delete following files? \n",n=[];e.state.selectedFilesForAction.forEach((function(e,a){n.push(e.path),t+=e.path+"\n"})),window.confirm(t)&&(A("Deleting Files"),P(!0),i({type:"DELETE_FILES",payload:n}),W(n,0))}(t),t.id===s.p$.CopyFiles.id&&function(e){var t=[];e.state.selectedFiles.forEach((function(e,n){t.push(e.path)})),E(t)}(t),t.id===fe.id&&(n=[],m.forEach((function(e,t){var a=u+f;e.indexOf(".")>-1&&(a=(null!==u?u+f:"")+e.split(f)[e.split(f).length-1]),n.push(a)})),te(m,n)),t.id===s.p$.StartDragNDrop.id&&function(e){C(!0);var t=[];e.state.selectedFiles.forEach((function(e,n){t.push(e.path)})),F(t)}(t),t.id===s.p$.EndDragNDrop.id&&function(e){C(!1);var t=[];g.forEach((function(n,a){var l="";l=null!==u?u+e.payload.destination.path.split(u)[1]:e.payload.destination.path.split("/home/pi/")[1],n.indexOf(".")>-1&&(l+=f+n.split(f)[n.split(f).length-1]).indexOf("undefined")>-1&&(l=l.split("undefined").join("")),t.push(l)})),g.length>0&&t.length>0&&g[0]!==t[0]&&te(g,t,!0)}(t)},defaultFileViewActionId:s.p$.EnableListView.id,clearSelectionOnOutsideClick:!0,ref:Y,disableDefaultFileActions:[s.p$.OpenSelection.id]},o.createElement(Z,{getFiles:e.getFiles}),o.createElement(s.TY,null),o.createElement(s.mF,null),o.createElement(s.e9,{disableDefaultFileActions:[s.p$.SelectAllFiles.id]})))}}}]);